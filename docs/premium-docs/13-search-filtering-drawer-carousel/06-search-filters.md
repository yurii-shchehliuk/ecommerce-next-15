# Search Filters

When we visit the search page, we are able to add query params to the URL and those are getting passed to the `getAllProducts` action. However, we aren't using them. So let's add them to the `getAllProducts` action.

A URL will look like this with all filters - http://localhost:3000/search?q=shirt&category=Men%27s%20Dress%20Shirts&price=10-40&rating=4&sort=newest

So we want to handle the values in the action and then use them to filter the products.

## Query Filter

Let's start with the query filter. When we type in the search bar, the query is added to the url and added to the `getAllProducts` call in the search page.

Open the action file at `lib/actions/products.actions.ts` and add the following code to the `getAllProducts` function right at the top:

```ts
// Filter by query
const queryFilter: Prisma.ProductWhereInput =
  query && query !== 'all'
    ? {
        name: {
          contains: query,
          mode: 'insensitive',
        } as Prisma.StringFilter,
      }
    : {};
```

You have to import the Prisma client as well:

```ts
import { Prisma } from '@prisma/client';
```

The `ProductWhereInput` in the context of Prisma refers to a filter input type generated by Prisma for the Product model. It allows you to define conditions (or filters) for querying records from the Product table in your database.

We are checking if the query is not `all` (the default) and if it is not, we are adding a `name` filter to the query. We are using the `contains` operator to check if the query is contained in the name of the product. We are also using the `insensitive` mode to make the search case-insensitive. We are using the `as Prisma.StringFilter` to tell TypeScript that we are using the `StringFilter` type from the Prisma client. For some reason, when I added the "mode" option, I got a type error. So I had to add the `as Prisma.StringFilter` to tell TypeScript that we are using the `StringFilter` type from the Prisma client.

Now we need to add it to the actual `findMany` function:

```ts
// Fetch products
const data = await prisma.product.findMany({
  where: {
    ...queryFilter,
  },
  skip: (page - 1) * limit,
  take: limit,
});
```

Now try your search component. It should filter the products based on the query. If you are using the sample data, try searching for `shirt` or `polo`.

## Category Filter

Now let's add the category filter. We will use the same approach as the query filter. We will add a `category` filter to the query and add it to the `findMany` function.

Start with the action file. Add the following code to the `getAllProducts` function:

```ts
// Filter by category
const categoryFilter = category && category !== 'all' ? { category } : {};
```

Now add it to the `where` in the `findMany` function:

```ts
where: {
  ...queryFilter,
  ...categoryFilter,
},
```

Now either open the category drawer and click on a category or enter a URL like this - http://localhost:3000/search?category=Men%27s%20Dress%20Shirts

## Price Filter

Let's add the price filter

```ts
// Filter by price
const priceFilter: Prisma.ProductWhereInput =
  price && price !== 'all'
    ? {
        price: {
          gte: Number(price.split('-')[0]),
          lte: Number(price.split('-')[1]),
        },
      }
    : {};
```

Now add it to the `where` in the `findMany` function:

```ts
 where: {
      ...queryFilter,
      ...categoryFilter,
      ...priceFilter,
    },
```

You can test this by using a URL like this - http://localhost:3000/search?price=10-40

This will show you the products with a price between 10 and 40.

## Rating Filter

The last filter is the rating filter. We will use the same approach as the previous filters.

```ts
// Filter by rating
const ratingFilter =
  rating && rating !== 'all' ? { rating: { gte: Number(rating) } } : {};
```

Now add it to the `where` in the `findMany` function:

```ts
  where: {
      ...queryFilter,
      ...categoryFilter,
      ...priceFilter,
      ...ratingFilter,
    },
```

Right now all ratings are 0, but you can still test with these URLs:

```
http://localhost:3000/search?category=Men%27s%20Dress%20Shirts&rating=0 // all products
http://localhost:3000/search?category=Men%27s%20Dress%20Shirts&rating=1 // no products

```
